{"version":3,"file":"browser.js","sources":["../src/log.ts","../src/hooks/DrawCallHook.ts","../src/hooks/ShaderHook.ts","../src/hooks/TextureHook.ts","../src/Core.ts","../src/Monitor.ts","../src/Stats.ts","../src/index.ts"],"sourcesContent":["import { Logger } from \"oasis-engine\";\n\nexport function log(...args: any) {\n  Logger.info(\"🚀 [o3-engine-stats]\", ...args);\n}\n\nexport function errorLog(...args: any) {\n  Logger.error(\"🚀 [o3-engine-stats]\", ...args);\n}\n","import { log, errorLog } from \"../log\";\n\n/**\n * @class DrawCallHook\n */\nexport default class DrawCallHook {\n  public drawCall: number = 0;\n  public triangles: number = 0;\n  public lines: number = 0;\n  public points: number = 0;\n  private hooked: boolean;\n  private realDrawElements: any;\n  private realDrawArrays: any;\n  private gl: WebGLRenderingContext | WebGL2RenderingContext;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.realDrawElements = gl.drawElements;\n    this.realDrawArrays = gl.drawArrays;\n\n    gl.drawElements = this.hookedDrawElements.bind(this);\n    gl.drawArrays = this.hookedDrawArrays.bind(this);\n\n    this.hooked = true;\n    this.gl = gl;\n\n    log(`DrawCall is hooked.`);\n  }\n\n  private hookedDrawElements(mode: number, count: number, type: number, offset: number) {\n    this.realDrawElements.call(this.gl, mode, count, type, offset);\n    this.update(count, mode);\n  }\n\n  private hookedDrawArrays(mode: number, first: number, count: number) {\n    this.realDrawArrays.call(this.gl, mode, first, count);\n    this.update(count, mode);\n  }\n\n  private update(count: number, mode: number) {\n    const { gl } = this;\n\n    this.drawCall++;\n\n    switch (mode) {\n      case gl.TRIANGLES:\n        this.triangles += count / 3;\n        break;\n\n      case gl.TRIANGLE_STRIP:\n      case gl.TRIANGLE_FAN:\n        this.triangles += count - 2;\n        break;\n\n      case gl.LINES:\n        this.lines += count / 2;\n        break;\n\n      case gl.LINE_STRIP:\n        this.lines += count - 1;\n        break;\n\n      case gl.LINE_LOOP:\n        this.lines += count;\n        break;\n\n      case gl.POINTS:\n        this.points += count;\n        break;\n\n      default:\n        errorLog(`Unknown draw mode: ${mode}`);\n        break;\n    }\n  }\n\n  public reset(): void {\n    this.drawCall = 0;\n    this.triangles = 0;\n    this.lines = 0;\n    this.points = 0;\n  }\n\n  public release(): void {\n    if (this.hooked) {\n      this.gl.drawElements = this.realDrawElements;\n      this.gl.drawArrays = this.realDrawArrays;\n    }\n\n    this.hooked = false;\n  }\n}\n","import { log, errorLog } from \"../log\";\n\n/**\n * @class ShaderHook\n */\nexport default class ShaderHook {\n  public shaders: number = 0;\n  private realAttachShader: any;\n  private realDetachShader: any;\n  private hooked: boolean;\n  private gl: WebGLRenderingContext | WebGL2RenderingContext;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.realAttachShader = gl.attachShader;\n    this.realDetachShader = gl.detachShader;\n\n    gl.attachShader = this.hookedAttachShader.bind(this);\n    gl.detachShader = this.hookedDetachShader.bind(this);\n\n    this.hooked = true;\n    this.gl = gl;\n\n    log(`Shader is hooked.`);\n  }\n\n  private hookedAttachShader(program: any, shader: any) {\n    this.realAttachShader.call(this.gl, program, shader);\n\n    this.shaders++;\n\n    log(`AttachShader:`, shader, `shaders: ${this.shaders}`);\n  }\n\n  private hookedDetachShader(program: any, shader: any) {\n    this.realDetachShader.call(this.gl, program, shader);\n\n    this.shaders--;\n\n    log(`DetachShader. shaders: ${this.shaders}`);\n  }\n\n  public reset() {\n    this.shaders = 0;\n  }\n\n  public release() {\n    if (this.hooked) {\n      this.gl.attachShader = this.realAttachShader;\n      this.gl.detachShader = this.realDetachShader;\n    }\n\n    this.hooked = false;\n  }\n}\n","import { log, errorLog } from \"../log\";\n\n/**\n * @class TextureHook\n */\nexport default class TextureHook {\n  public textures: number = 0;\n  private realCreateTexture: any;\n  private realDeleteTexture: any;\n  private hooked: boolean;\n  private gl: WebGLRenderingContext | WebGL2RenderingContext;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.realCreateTexture = gl.createTexture;\n    this.realDeleteTexture = gl.deleteTexture;\n\n    gl.createTexture = this.hookedCreateTexture.bind(this);\n    gl.deleteTexture = this.hookedDeleteTexture.bind(this);\n\n    this.hooked = true;\n    this.gl = gl;\n\n    log(`Texture is hooked.`);\n  }\n\n  private hookedCreateTexture() {\n    let texture = this.realCreateTexture.call(this.gl);\n\n    this.textures++;\n\n    log(`CreateTexture:`, texture, `textures: ${this.textures}`);\n\n    return texture;\n  }\n\n  private hookedDeleteTexture(texture: any) {\n    this.realDeleteTexture.call(this.gl, texture);\n\n    this.textures--;\n\n    log(`DeleteTexture. textures: ${this.textures}`);\n  }\n\n  public reset() {\n    this.textures = 0;\n  }\n\n  public release() {\n    if (this.hooked) {\n      this.gl.createTexture = this.realCreateTexture;\n      this.gl.deleteTexture = this.realDeleteTexture;\n    }\n\n    this.hooked = false;\n  }\n}\n","import { Entity } from \"oasis-engine\";\nimport DrawCallHook from \"./hooks/DrawCallHook\";\nimport ShaderHook from \"./hooks/ShaderHook\";\nimport TextureHook from \"./hooks/TextureHook\";\n\ndeclare global {\n  interface Performance {\n    memory: any;\n  }\n}\n\n/**\n * @class Core\n */\nexport default class Core {\n  private gl: WebGLRenderingContext | WebGL2RenderingContext;\n  private drawCallHook: DrawCallHook;\n  private textureHook: TextureHook;\n  private shaderHook: ShaderHook;\n  private samplingFrames: number = 60;\n  private samplingIndex: number = 0;\n  private now: number;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.gl = gl;\n    this.hook(gl);\n  }\n\n  private hook(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.drawCallHook = new DrawCallHook(gl);\n    this.textureHook = new TextureHook(gl);\n    this.shaderHook = new ShaderHook(gl);\n  }\n\n  public reset() {\n    this.drawCallHook && this.drawCallHook.reset();\n  }\n\n  public release() {\n    this.drawCallHook && this.drawCallHook.release();\n    this.textureHook && this.textureHook.release();\n    this.shaderHook && this.shaderHook.release();\n  }\n\n  public update() {\n    let now = performance.now();\n    let delta = now - this.now;\n    this.now = now;\n\n    if (this.samplingIndex !== this.samplingFrames) {\n      this.reset();\n      this.samplingIndex++;\n      return;\n    }\n\n    this.samplingIndex = 0;\n\n    let data = {\n      fps: delta ? (1000 / delta) >> 0 : 0,\n      memory: performance.memory && (performance.memory.usedJSHeapSize / 1048576) >> 0,\n      drawCall: this.drawCallHook.drawCall,\n      triangles: this.drawCallHook.triangles,\n      //@ts-ignorets-ignore\n      nodes: Entity._entitys.length,\n      lines: this.drawCallHook.lines,\n      points: this.drawCallHook.points,\n      textures: this.textureHook.textures,\n      shaders: this.shaderHook.shaders,\n      webglContext:\n        window.hasOwnProperty(\"WebGL2RenderingContext\") && this.gl instanceof WebGL2RenderingContext ? \"2.0\" : \"1.0\"\n    };\n\n    this.reset();\n\n    return data;\n  }\n}\n","import Core from \"./Core\";\n\nlet tpl = `\n  <dl>\n    <dt>FPS</dt>\n    <dd>0</dd>\n    <dt>Memory <span class=\"unit\">(MB)</span></dt>\n    <dd>0</dd>\n    <dt>DrawCall</dt>\n    <dd>0</dd>\n    <dt>Triangles</dt>\n    <dd>0</dd>\n    <dt>Nodes</dt>\n    <dd>0</dd>\n    <dt>Textures</dt>\n    <dd>0</dd>\n    <dt>Shaders</dt>\n    <dd>0</dd>\n    <dt>WebGL</dt>\n    <dd></dd>\n  </dl>\n`;\nlet css = `\n  .gl-perf {\n    pointer-events: none;\n    user-select: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    padding: ${10 / 7.5}vh ${10 / 7.5}vh 0 ${10 / 7.5}vh;\n    background: rgba(0, 0, 0, 0.3);\n    color: #fff;\n    font: ${10 / 7.5}vh arial;\n  }\n\n  .gl-perf dl,\n  .gl-perf dt,\n  .gl-perf dd {\n    padding: 0;\n    margin: 0;\n  }\n\n  .gl-perf dt {\n    color: #fff;\n    text-shadow: #000 0 0 1px;\n  }\n\n  .gl-perf dt .unit{\n    font-size: ${10 / 7.5}vh;\n  }\n\n  .gl-perf dd {\n    font-size: ${20 / 7.5}vh;\n    padding: ${10 / 7.5}vh 0 ${10 / 7.5}vh;\n  }\n`;\n\nexport default class Monitor {\n  private core: Core;\n  private doms: HTMLElement[];\n  private items: string[];\n  private container: HTMLElement;\n\n  constructor(gl: WebGLRenderingContext | WebGL2RenderingContext) {\n    this.core = new Core(gl);\n    this.items = [];\n    this.items = [\"fps\", \"memory\", \"drawCall\", \"triangles\", \"nodes\", \"textures\", \"shaders\", \"webglContext\"];\n    this.createContainer();\n    this.update = this.update.bind(this);\n  }\n\n  private createContainer() {\n    let container = document.createElement(\"div\");\n    container.classList.add(\"gl-perf\");\n    container.innerHTML = tpl;\n\n    container.appendChild(this.createStyle());\n\n    document.body.appendChild(container);\n\n    this.doms = Array.prototype.slice.apply(container.querySelectorAll(\"dd\"));\n    this.container = container;\n  }\n\n  private createStyle() {\n    let style: HTMLStyleElement = document.createElement(\"style\");\n\n    style.type = \"text/css\";\n\n    style.appendChild(document.createTextNode(css));\n\n    return style;\n  }\n\n  /**\n   * Update per frame\n   */\n  public update() {\n    let data = this.core.update();\n\n    if (data) {\n      for (let i = 0, l = this.items.length; i < l; i++) {\n        let dom = this.doms[i];\n        let item = this.items[i];\n        let value = data[item] || 0;\n\n        // see: http://wilsonpage.co.uk/preventing-layout-thrashing/\n        requestAnimationFrame(() => {\n          dom.innerText = value;\n        });\n      }\n    }\n  }\n\n  /**\n   * reset all hooks\n   */\n  public reset() {\n    this.core.reset();\n  }\n\n  /**\n   * release all hooks\n   */\n  public release() {\n    this.core.release();\n  }\n\n  /**\n   * destory the instance\n   */\n  public destroy() {\n    this.release();\n    document.body.removeChild(this.container);\n  }\n}\n","import { EngineFeature, Engine, Scene } from \"oasis-engine\";\nimport Monitor from \"./Monitor\";\n\n/**\n * Engine Feature：显示 FPS 等引擎状态数据\n */\nexport class Stats extends EngineFeature {\n  private monitor: Monitor;\n  /**\n   * 构造函数\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * tick 前置回调\n   */\n  preTick(engine: Engine, currentScene: Scene): void {\n    if (!this.monitor) {\n      const gl = currentScene.engine._hardwareRenderer.gl;\n      if (gl) {\n        this.monitor = new Monitor(gl);\n      }\n    }\n  }\n\n  /**\n   * tick 后置回调\n   */\n  postTick(engine: Engine, currentScene: Scene): void {\n    if (this.monitor) {\n      this.monitor.update();\n    }\n  }\n}\n","import { Engine } from \"oasis-engine\";\nimport { Stats } from \"./Stats\";\n\nEngine.registerFeature(Stats);\n\nexport { Stats };\n"],"names":["log","args","Logger","info","errorLog","error","DrawCallHook","gl","drawCall","triangles","lines","points","hooked","realDrawElements","realDrawArrays","drawElements","drawArrays","hookedDrawElements","bind","hookedDrawArrays","mode","count","type","offset","call","update","first","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN","LINES","LINE_STRIP","LINE_LOOP","POINTS","ShaderHook","shaders","realAttachShader","realDetachShader","attachShader","detachShader","hookedAttachShader","hookedDetachShader","program","shader","TextureHook","textures","realCreateTexture","realDeleteTexture","createTexture","deleteTexture","hookedCreateTexture","hookedDeleteTexture","texture","Core","drawCallHook","textureHook","shaderHook","samplingFrames","samplingIndex","now","hook","reset","release","performance","delta","data","fps","memory","usedJSHeapSize","nodes","Entity","_entitys","length","webglContext","window","hasOwnProperty","WebGL2RenderingContext","tpl","css","Monitor","core","doms","items","container","createContainer","document","createElement","classList","add","innerHTML","appendChild","createStyle","body","Array","prototype","slice","apply","querySelectorAll","style","createTextNode","i","l","dom","item","value","requestAnimationFrame","innerText","removeChild","Stats","monitor","engine","currentScene","_hardwareRenderer","EngineFeature","Engine","registerFeature"],"mappings":"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"}