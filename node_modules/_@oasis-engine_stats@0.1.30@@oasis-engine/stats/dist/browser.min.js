!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("oasis-engine")):"function"==typeof define&&define.amd?define(["exports","oasis-engine"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@oasisEngine/stats"]={},e.oasisEngine)}(this,(function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=s(e);if(t){var i=s(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return o(this,r)}}function d(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];t.Logger.info.apply(t.Logger,["ðŸš€ [o3-engine-stats]"].concat(r))}var l=function(){function e(t){r(this,e),this.drawCall=0,this.triangles=0,this.lines=0,this.points=0,this.hooked=void 0,this.realDrawElements=void 0,this.realDrawArrays=void 0,this.gl=void 0,this.realDrawElements=t.drawElements,this.realDrawArrays=t.drawArrays,t.drawElements=this.hookedDrawElements.bind(this),t.drawArrays=this.hookedDrawArrays.bind(this),this.hooked=!0,this.gl=t,d("DrawCall is hooked.")}return i(e,[{key:"hookedDrawElements",value:function(e,t,r,n){this.realDrawElements.call(this.gl,e,t,r,n),this.update(t,e)}},{key:"hookedDrawArrays",value:function(e,t,r){this.realDrawArrays.call(this.gl,e,t,r),this.update(r,e)}},{key:"update",value:function(e,r){var n=this.gl;switch(this.drawCall++,r){case n.TRIANGLES:this.triangles+=e/3;break;case n.TRIANGLE_STRIP:case n.TRIANGLE_FAN:this.triangles+=e-2;break;case n.LINES:this.lines+=e/2;break;case n.LINE_STRIP:this.lines+=e-1;break;case n.LINE_LOOP:this.lines+=e;break;case n.POINTS:this.points+=e;break;default:!function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];t.Logger.error.apply(t.Logger,["ðŸš€ [o3-engine-stats]"].concat(r))}("Unknown draw mode: ".concat(r))}}},{key:"reset",value:function(){this.drawCall=0,this.triangles=0,this.lines=0,this.points=0}},{key:"release",value:function(){this.hooked&&(this.gl.drawElements=this.realDrawElements,this.gl.drawArrays=this.realDrawArrays),this.hooked=!1}}]),e}(),c=function(){function e(t){r(this,e),this.shaders=0,this.realAttachShader=void 0,this.realDetachShader=void 0,this.hooked=void 0,this.gl=void 0,this.realAttachShader=t.attachShader,this.realDetachShader=t.detachShader,t.attachShader=this.hookedAttachShader.bind(this),t.detachShader=this.hookedDetachShader.bind(this),this.hooked=!0,this.gl=t,d("Shader is hooked.")}return i(e,[{key:"hookedAttachShader",value:function(e,t){this.realAttachShader.call(this.gl,e,t),this.shaders++,d("AttachShader:",t,"shaders: ".concat(this.shaders))}},{key:"hookedDetachShader",value:function(e,t){this.realDetachShader.call(this.gl,e,t),this.shaders--,d("DetachShader. shaders: ".concat(this.shaders))}},{key:"reset",value:function(){this.shaders=0}},{key:"release",value:function(){this.hooked&&(this.gl.attachShader=this.realAttachShader,this.gl.detachShader=this.realDetachShader),this.hooked=!1}}]),e}(),u=function(){function e(t){r(this,e),this.textures=0,this.realCreateTexture=void 0,this.realDeleteTexture=void 0,this.hooked=void 0,this.gl=void 0,this.realCreateTexture=t.createTexture,this.realDeleteTexture=t.deleteTexture,t.createTexture=this.hookedCreateTexture.bind(this),t.deleteTexture=this.hookedDeleteTexture.bind(this),this.hooked=!0,this.gl=t,d("Texture is hooked.")}return i(e,[{key:"hookedCreateTexture",value:function(){var e=this.realCreateTexture.call(this.gl);return this.textures++,d("CreateTexture:",e,"textures: ".concat(this.textures)),e}},{key:"hookedDeleteTexture",value:function(e){this.realDeleteTexture.call(this.gl,e),this.textures--,d("DeleteTexture. textures: ".concat(this.textures))}},{key:"reset",value:function(){this.textures=0}},{key:"release",value:function(){this.hooked&&(this.gl.createTexture=this.realCreateTexture,this.gl.deleteTexture=this.realDeleteTexture),this.hooked=!1}}]),e}(),f=function(){function e(t){r(this,e),this.gl=void 0,this.drawCallHook=void 0,this.textureHook=void 0,this.shaderHook=void 0,this.samplingFrames=60,this.samplingIndex=0,this.now=void 0,this.gl=t,this.hook(t)}return i(e,[{key:"hook",value:function(e){this.drawCallHook=new l(e),this.textureHook=new u(e),this.shaderHook=new c(e)}},{key:"reset",value:function(){this.drawCallHook&&this.drawCallHook.reset()}},{key:"release",value:function(){this.drawCallHook&&this.drawCallHook.release(),this.textureHook&&this.textureHook.release(),this.shaderHook&&this.shaderHook.release()}},{key:"update",value:function(){var e=performance.now(),r=e-this.now;if(this.now=e,this.samplingIndex!==this.samplingFrames)return this.reset(),void this.samplingIndex++;this.samplingIndex=0;var n={fps:r?1e3/r>>0:0,memory:performance.memory&&performance.memory.usedJSHeapSize/1048576>>0,drawCall:this.drawCallHook.drawCall,triangles:this.drawCallHook.triangles,nodes:t.Entity._entitys.length,lines:this.drawCallHook.lines,points:this.drawCallHook.points,textures:this.textureHook.textures,shaders:this.shaderHook.shaders,webglContext:window.hasOwnProperty("WebGL2RenderingContext")&&this.gl instanceof WebGL2RenderingContext?"2.0":"1.0"};return this.reset(),n}}]),e}(),p="\n  .gl-perf {\n    pointer-events: none;\n    user-select: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    padding: ".concat(10/7.5,"vh ").concat(10/7.5,"vh 0 ").concat(10/7.5,"vh;\n    background: rgba(0, 0, 0, 0.3);\n    color: #fff;\n    font: ").concat(10/7.5,"vh arial;\n  }\n\n  .gl-perf dl,\n  .gl-perf dt,\n  .gl-perf dd {\n    padding: 0;\n    margin: 0;\n  }\n\n  .gl-perf dt {\n    color: #fff;\n    text-shadow: #000 0 0 1px;\n  }\n\n  .gl-perf dt .unit{\n    font-size: ").concat(10/7.5,"vh;\n  }\n\n  .gl-perf dd {\n    font-size: ").concat(20/7.5,"vh;\n    padding: ").concat(10/7.5,"vh 0 ").concat(10/7.5,"vh;\n  }\n"),g=function(){function e(t){r(this,e),this.core=void 0,this.doms=void 0,this.items=void 0,this.container=void 0,this.core=new f(t),this.items=[],this.items=["fps","memory","drawCall","triangles","nodes","textures","shaders","webglContext"],this.createContainer(),this.update=this.update.bind(this)}return i(e,[{key:"createContainer",value:function(){var e=document.createElement("div");e.classList.add("gl-perf"),e.innerHTML='\n  <dl>\n    <dt>FPS</dt>\n    <dd>0</dd>\n    <dt>Memory <span class="unit">(MB)</span></dt>\n    <dd>0</dd>\n    <dt>DrawCall</dt>\n    <dd>0</dd>\n    <dt>Triangles</dt>\n    <dd>0</dd>\n    <dt>Nodes</dt>\n    <dd>0</dd>\n    <dt>Textures</dt>\n    <dd>0</dd>\n    <dt>Shaders</dt>\n    <dd>0</dd>\n    <dt>WebGL</dt>\n    <dd></dd>\n  </dl>\n',e.appendChild(this.createStyle()),document.body.appendChild(e),this.doms=Array.prototype.slice.apply(e.querySelectorAll("dd")),this.container=e}},{key:"createStyle",value:function(){var e=document.createElement("style");return e.type="text/css",e.appendChild(document.createTextNode(p)),e}},{key:"update",value:function(){var e=this,t=this.core.update();if(t)for(var r=function(r,n){var i=e.doms[r],s=e.items[r],a=t[s]||0;requestAnimationFrame((function(){i.innerText=a}))},n=0,i=this.items.length;n<i;n++)r(n)}},{key:"reset",value:function(){this.core.reset()}},{key:"release",value:function(){this.core.release()}},{key:"destroy",value:function(){this.release(),document.body.removeChild(this.container)}}]),e}(),k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,e);var t=h(n);function n(){var e;return r(this,n),(e=t.call(this)).monitor=void 0,e}return i(n,[{key:"preTick",value:function(e,t){if(!this.monitor){var r=t.engine._hardwareRenderer.gl;r&&(this.monitor=new g(r))}}},{key:"postTick",value:function(e,t){this.monitor&&this.monitor.update()}}]),n}(t.EngineFeature);t.Engine.registerFeature(k),e.Stats=k,Object.defineProperty(e,"__esModule",{value:!0})}));
