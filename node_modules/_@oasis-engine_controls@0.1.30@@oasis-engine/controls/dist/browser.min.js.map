{"version":3,"file":"browser.min.js","sources":["../src/FreeControl.ts","../src/OrbitControl.ts"],"sourcesContent":["import { Entity, Logger, MathUtil, Script, Spherical, Vector3 } from \"oasis-engine\";\nimport { doTransform, Easing, Tween } from \"@oasis-engine/tween\";\n\n// 防止万向锁\nconst ESP = MathUtil.zeroTolerance;\n\nfunction includes(array, ...filterArray) {\n  return filterArray.some((e) => array.indexOf(e) !== -1);\n}\n\nconst tween = new Tween();\n\n/**\n * 相机的的漫游控制器，可以上下左右位移，转转视角。\n */\nexport class FreeControl extends Script {\n  _forward = new Vector3();\n  _right = new Vector3();\n  camera: Entity;\n  mainElement: any;\n  domElement: any;\n\n  /** 每秒运动距离，单位为MVP转换前的单位\n   * @member {number}\n   * */\n  movementSpeed: number;\n\n  /** 一个canvas的高宽度旋转Math.PI* this.rotateSpeed\n   * @member {number}\n   * */\n  rotateSpeed: number;\n\n  /** 模拟一个地面用来jump，替代碰撞体\n   * @member {boolean}\n   * */\n  floorMock: boolean;\n\n  /** 模拟地面高度\n   * @member {number}\n   * */\n  floorY: number;\n\n  /**\n   * the heightY jump to\n   * @member {number}\n   * */\n  jumpY: number;\n\n  /**\n   * the amount of the jumping time, jumpUpDuration+jumpDownDuration\n   * unit:ms\n   * @member {number}\n   * */\n  jumpDuration: number;\n\n  /** only rotate when press=true\n   * @member {boolean}\n   * */\n  press: boolean;\n  keysForward: Array<string | number>;\n  keysBackward: Array<string | number>;\n  keysLeft: Array<string | number>;\n  keysRight: Array<string | number>;\n  keysJump: Array<string | number>;\n\n  /**\n   * radian of spherical.theta\n   * @member {number}\n   * */\n  private _theta: number;\n\n  /**\n   * radian of spherical.phi\n   * @member {number}\n   * */\n  private _phi: number;\n\n  private _moveForward: boolean;\n  private _moveBackward: boolean;\n  private _moveLeft: boolean;\n  private _moveRight: boolean;\n  private _moveJump: boolean;\n\n  private _v3Cache: Vector3;\n  private _spherical: Spherical;\n  private _rotateOri: Array<number>;\n  private _events: Array<{ type: string; listener: () => {}; element?: any }>;\n\n  /**\n   * 漫游控制器构造函数\n   * @param {Entity} entity 挂载节点\n   */\n  constructor(entity: Entity) {\n    super(entity);\n    this.camera = entity;\n    //@ts-ignore @todo 未来移除对html元素的依赖，通过封装引擎的input实现\n    this.mainElement = this.scene.engine.canvas._webCanvas;\n    this.domElement = document;\n\n    this.movementSpeed = 1.0;\n    this.rotateSpeed = 1.0;\n\n    this.floorMock = true;\n    this.floorY = 0;\n\n    this.jumpY = 1;\n    this.jumpDuration = 600;\n\n    this.press = false;\n\n    this.keysForward = [\"KeyW\", \"ArrowUp\"];\n    this.keysBackward = [\"KeyS\", \"ArrowDown\"];\n    this.keysLeft = [\"KeyA\", \"ArrowLeft\"];\n    this.keysRight = [\"KeyD\", \"ArrowRight\"];\n    this.keysJump = [\"Space\"];\n\n    this._theta = 0;\n    this._phi = 0;\n\n    // private variables\n    this._moveForward = false;\n    this._moveBackward = false;\n    this._moveLeft = false;\n    this._moveRight = false;\n    this._moveJump = false;\n\n    this._v3Cache = new Vector3();\n    this._spherical = new Spherical();\n    this._rotateOri = [0, 0];\n\n    this._events = [\n      { type: \"mousemove\", listener: this.onMouseMove.bind(this) },\n      { type: \"touchmove\", listener: this.onMouseMove.bind(this) },\n      { type: \"mousedown\", listener: this.onMouseDown.bind(this) },\n      { type: \"touchstart\", listener: this.onMouseDown.bind(this) },\n      { type: \"mouseup\", listener: this.onMouseUp.bind(this) },\n      { type: \"touchend\", listener: this.onMouseUp.bind(this) },\n      { type: \"keydown\", listener: this.onKeyDown.bind(this), element: window },\n      { type: \"keyup\", listener: this.onKeyUp.bind(this), element: window },\n      { type: \"contextmenu\", listener: this.onContextMenu.bind(this) }\n    ];\n\n    this.initEvents();\n\n    // init spherical\n    this.updateSpherical();\n  }\n\n  /**\n   * 浏览器右键事件\n   * @private\n   * */\n  onContextMenu(event): void {\n    event.preventDefault();\n  }\n\n  /**\n   * 键盘按下事件\n   * @private\n   * */\n  onKeyDown(event): void {\n    const { code, key, keyCode } = event;\n    if (includes(this.keysForward, code, key, keyCode)) {\n      this._moveForward = true;\n    } else if (includes(this.keysBackward, code, key, keyCode)) {\n      this._moveBackward = true;\n    } else if (includes(this.keysLeft, code, key, keyCode)) {\n      this._moveLeft = true;\n    } else if (includes(this.keysRight, code, key, keyCode)) {\n      this._moveRight = true;\n    } else if (includes(this.keysJump, code, key, keyCode)) {\n      this.jump();\n    }\n  }\n\n  /**\n   * 键盘抬起事件\n   * @private\n   * */\n  onKeyUp(event): void {\n    const { code, key, keyCode } = event;\n    if (includes(this.keysForward, code, key, keyCode)) {\n      this._moveForward = false;\n    } else if (includes(this.keysBackward, code, key, keyCode)) {\n      this._moveBackward = false;\n    } else if (includes(this.keysLeft, code, key, keyCode)) {\n      this._moveLeft = false;\n    } else if (includes(this.keysRight, code, key, keyCode)) {\n      this._moveRight = false;\n    }\n  }\n\n  /**\n   * 手势按下事件\n   * @private\n   * */\n  onMouseDown(event): void {\n    event.stopPropagation();\n    event = (event.changedTouches && event.changedTouches[0]) || event;\n\n    if (this.domElement !== document) {\n      this.domElement.focus();\n    }\n\n    this.press = true;\n    this._rotateOri = [event.clientX, event.clientY];\n  }\n\n  /**\n   * 手势抬起事件\n   * @private\n   * */\n  onMouseUp(event): void {\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.press = false;\n  }\n\n  /**\n   * 手势滑动事件\n   * @private\n   * */\n  onMouseMove(event): void {\n    if (this.press === false) return;\n    if (this.enabled === false) return;\n\n    event.preventDefault();\n    event.stopPropagation();\n    event = (event.changedTouches && event.changedTouches[0]) || event;\n\n    const movementX = event.clientX - this._rotateOri[0];\n    const movementY = event.clientY - this._rotateOri[1];\n    this._rotateOri[0] = event.clientX;\n    this._rotateOri[1] = event.clientY;\n    const factorX = 180 / this.mainElement.width;\n    const factorY = 180 / this.mainElement.height;\n    const actualX = movementX * factorX;\n    const actualY = movementY * factorY;\n\n    this.rotate(-actualX, actualY);\n  }\n\n  /**\n   * 分别绕y轴，x轴旋转的角度\n   * unit:deg\n   * @param {number} alpha - 绕y轴旋转的deg\n   * @param {number} beta - 绕x轴旋转的deg\n   * */\n  rotate(alpha: number = 0, beta: number = 0): void {\n    this._theta += MathUtil.degreeToRadian(alpha);\n    this._phi += MathUtil.degreeToRadian(beta);\n    this._phi = MathUtil.clamp(this._phi, ESP, Math.PI - ESP);\n    this._spherical.theta = this._theta;\n    this._spherical.phi = this._phi;\n    this._spherical.setToVec3(this._v3Cache);\n    Vector3.add(this.camera.position, this._v3Cache, this._v3Cache);\n    this.camera.transform.lookAt(this._v3Cache, new Vector3(0, 1, 0));\n  }\n\n  /**\n   * 跳跃，根据jumpY确定高度，jumpDuration确定时间，floorY确定地面高度\n   * */\n  jump(): void {\n    if (this._moveJump) return;\n\n    this._moveJump = true;\n\n    let p = this.camera.position;\n\n    doTransform\n      .Translate(this.camera, new Vector3(p.x, this.jumpY, p.z), this.jumpDuration / 2, {\n        easing: Easing.easeOutSine,\n        onComplete: () => {\n          doTransform\n            .Translate(this.camera, new Vector3(p.x, this.floorY, p.z), this.jumpDuration / 2, {\n              easing: Easing.easeInSine,\n              onComplete: () => {\n                this._moveJump = false;\n              }\n            })\n            .start(tween);\n        }\n      })\n      .start(tween);\n  }\n\n  /**\n   * transform vec3 on axis by distance\n   * */\n  translateOnAxis(axis: Readonly<Vector3>, distance: number, v3: Readonly<Vector3> = this.camera.position): void {\n    const diff: Vector3 = new Vector3();\n    Vector3.normalize(axis, diff);\n    v3.add(diff.scale(distance));\n  }\n\n  private tempVec3 = new Vector3();\n\n  /**\n   * @override\n   * translate camera per tick\n   * @param  delta - tick gap\n   * */\n  onUpdate(delta: number): void {\n    if (this.enabled === false) return;\n\n    const actualMoveSpeed = (delta / 1000) * this.movementSpeed;\n    this.camera.transform.getWorldForward(this._forward);\n    this.camera.transform.getWorldRight(this._right);\n    if (this._moveForward) {\n      this.translateOnAxis(this._forward, actualMoveSpeed);\n    }\n    if (this._moveBackward) {\n      this.translateOnAxis(this._forward, -actualMoveSpeed);\n    }\n    if (this._moveLeft) {\n      this.translateOnAxis(this._right, -actualMoveSpeed);\n    }\n    if (this._moveRight) {\n      this.translateOnAxis(this._right, actualMoveSpeed);\n    }\n\n    tween.update(delta);\n    const position = this.camera.transform.position;\n\n    if (this.floorMock && !this._moveJump) {\n      // this.camera.position[1] = this.floorY;\n\n      // const pos = this.camera.transform.position;\n      position.setValue(position.x, this.floorY, position.z);\n      this.camera.transform.position = position;\n    }\n  }\n\n  /**注册浏览器事件*/\n  initEvents(): void {\n    this._events.forEach((ele) => {\n      if (ele.element) {\n        ele.element.addEventListener(ele.type, ele.listener, false);\n      } else {\n        this.mainElement.addEventListener(ele.type, ele.listener, false);\n      }\n    });\n  }\n\n  /**\n   * dispose all events\n   * */\n  destroy(): void {\n    this._events.forEach((ele) => {\n      if (ele.element) {\n        ele.element.removeEventListener(ele.type, ele.listener, false);\n      } else {\n        this.mainElement.removeEventListener(ele.type, ele.listener, false);\n      }\n    });\n    super.destroy();\n  }\n\n  /**\n   * must updateSpherical after quaternion has been changed\n   * @example\n   * Entity#lookAt([0,1,0],[0,1,0]);\n   * AFreeControls#updateSpherical();\n   * */\n  updateSpherical(): void {\n    this._v3Cache.setValue(0, 0, -1);\n    Vector3.transformByQuat(this._v3Cache, this.camera.rotation, this._v3Cache);\n    this._spherical.setFromVec3(this._v3Cache);\n    this._theta = this._spherical.theta;\n    this._phi = this._spherical.phi;\n  }\n}\n","\"use strict\";\nimport { Entity, Logger, Matrix, Script, Spherical, Vector2, Vector3 } from \"oasis-engine\";\n\n/**\n * 相机的的轨道控制器，可以旋转，缩放，平移，支持鼠标和触摸事件。\n */\nexport class OrbitControl extends Script {\n  public camera: Entity;\n  public domElement: HTMLElement | Document;\n  public mainElement: HTMLCanvasElement;\n  public fov: number;\n  public target: Vector3;\n  public up: Vector3;\n  public minDistance: number;\n  public maxDistance: number;\n  public minZoom: number;\n  public maxZoom: number;\n  public enableDamping: boolean;\n  public zoomFactor: number;\n  public enableRotate: boolean;\n  public keyPanSpeed: number;\n  public minPolarAngle: number;\n  public maxPolarAngle: number;\n  public minAzimuthAngle: number;\n  public maxAzimuthAngle: number;\n  public enableZoom: boolean;\n  public dampingFactor: number;\n  public zoomSpeed: number;\n  public enablePan: boolean;\n  public autoRotate: boolean;\n  public autoRotateSpeed: number;\n  public rotateSpeed: number;\n  public enableKeys: boolean;\n  public keys: { LEFT: number; RIGHT: number; UP: number; BOTTOM: number };\n  public mouseButtons: { ORBIT: number; ZOOM: number; PAN: number };\n  public touchFingers: { ORBIT: number; ZOOM: number; PAN: number };\n  private _position: Vector3;\n  private _offset: Vector3;\n  private _spherical: Spherical;\n  private _sphericalDelta: Spherical;\n  private _sphericalDump: Spherical;\n  private _zoomFrag: number;\n  private _scale: number;\n  private _panOffset: Vector3;\n  private _isMouseUp: boolean;\n  private _vPan: Vector3;\n  public constEvents: { listener: any; type: string; element?: Window }[];\n  private _state: any;\n  private _rotateStart: Vector2;\n  private _rotateEnd: Vector2;\n  private _rotateDelta: Vector2;\n  private _panStart: Vector2;\n  private _panEnd: Vector2;\n  private _panDelta: Vector2;\n  private _zoomStart: Vector2;\n  private _zoomEnd: Vector2;\n  private _zoomDelta: Vector2;\n  public STATE: {\n    TOUCH_ROTATE: number;\n    ROTATE: number;\n    TOUCH_PAN: number;\n    ZOOM: number;\n    NONE: number;\n    PAN: number;\n    TOUCH_ZOOM: number;\n  };\n  public mouseUpEvents: { listener: any; type: string }[];\n\n  /**\n   * 轨道控制器构造函数\n   * @param {Entity} entity 挂载节点\n   */\n  constructor(entity: Entity) {\n    super(entity);\n\n    this.camera = entity;\n    //@ts-ignore @todo 未来移除对html元素的依赖，通过封装引擎的input实现\n    this.mainElement = this.engine.canvas._webCanvas;\n    this.domElement = document;\n    this.fov = 45;\n\n    // 目标点\n    this.target = new Vector3();\n\n    // up向量\n    this.up = new Vector3(0, 1, 0);\n\n    // 最大最小距离\n    /**\n     * 最小距离，默认为0.1，应大于0\n     * @member {Number}\n     */\n    this.minDistance = 0.1;\n    /**\n     * 最大距离，默认为无穷，应大于最小距离\n     * @member {Number}\n     */\n    this.maxDistance = Infinity;\n\n    // 最大最小缩放速度\n    /**\n     * 最小缩放速度，默认为0.0\n     * @member {Number}\n     */\n    this.minZoom = 0.0;\n    /**\n     * 最大缩放速度，默认为正无穷\n     * @member {Number}\n     */\n    this.maxZoom = Infinity;\n\n    // 垂直方向旋转范围\n    /**\n     * 垂直方向最小弧度，默认为0弧度，取值范围 0 － Math.PI\n     * @member {Number}\n     */\n    this.minPolarAngle = 0;\n    /**\n     * 垂直方向最大弧度，默认为Math.PI，取值范围 0 － Math.PI\n     * @member {Number}\n     */\n    this.maxPolarAngle = Math.PI;\n\n    // 水平方向旋转范围\n    /**\n     * 垂直方向最小弧度，默认为负无穷\n     * @member {Number}\n     */\n    this.minAzimuthAngle = -Infinity;\n    /**\n     * 垂直方向最小弧度，默认为正无穷\n     * @member {Number}\n     */\n    this.maxAzimuthAngle = Infinity;\n\n    // 缓冲参数\n    /**\n     * 是否开启镜头缓冲，默认为 true\n     * @member {Boolean}\n     */\n    this.enableDamping = true;\n    /**\n     * 旋转缓冲参数，默认为 0.1\n     * @member {Number}\n     */\n    this.dampingFactor = 0.1;\n    /**\n     * 缩放缓冲参数，默认为0.2\n     * @member {Number}\n     */\n    this.zoomFactor = 0.2;\n\n    // 缩放控制\n    /**\n     * 是否启用缩放，默认为true\n     * @member {Boolean}\n     */\n    this.enableZoom = true;\n    /**\n     * 镜头缩放速度，默认为1.0\n     * @member {Number}\n     */\n    this.zoomSpeed = 1.0;\n\n    // 旋转控制\n    /**\n     * 是否开启旋转，默认为true\n     * @member {Boolean}\n     */\n    this.enableRotate = true;\n    /**\n     * 旋转速度，默认为1.0\n     * @member {Number}\n     */\n    this.rotateSpeed = 1.0;\n\n    // 平移控制\n    /**\n     * 是否开启平移，默认为true\n     * @member {Number}\n     */\n    this.enablePan = true;\n    /**\n     * 键盘平移速度，默认为7.0\n     * @member {Number}\n     */\n    this.keyPanSpeed = 7.0;\n\n    // 自动旋转\n    /**\n     * 是否自动旋转镜头，默认为false\n     * @member {Boolean}\n     */\n    this.autoRotate = false;\n    /**\n     * 自动旋转一圈所需的时间，默认为2.0s\n     * @member {Number}\n     */\n    this.autoRotateSpeed = 2.0; // 旋转 2PI 所用的时间 s\n\n    // 键盘平移\n    /**\n     * 是否启用键盘平移，默认为false\n     * @member {Boolean}\n     */\n    this.enableKeys = false;\n    this.keys = {\n      LEFT: 37,\n      UP: 38,\n      RIGHT: 39,\n      BOTTOM: 40\n    };\n\n    // 控制键位\n    this.mouseButtons = {\n      ORBIT: 0,\n      ZOOM: 1,\n      PAN: 2\n    };\n    this.touchFingers = {\n      ORBIT: 1,\n      ZOOM: 2,\n      PAN: 3\n    };\n\n    // 复用对象 防止栈分配过多\n    // update\n    this._position = new Vector3();\n    this._offset = new Vector3();\n    this._spherical = new Spherical();\n    this._sphericalDelta = new Spherical();\n    this._sphericalDump = new Spherical();\n    this._zoomFrag = 0;\n    this._scale = 1;\n    this._panOffset = new Vector3();\n    this._isMouseUp = true;\n\n    // pan\n    this._vPan = new Vector3();\n\n    // state\n    this._rotateStart = new Vector2();\n    this._rotateEnd = new Vector2();\n    this._rotateDelta = new Vector2();\n\n    this._panStart = new Vector2();\n    this._panEnd = new Vector2();\n    this._panDelta = new Vector2();\n\n    this._zoomStart = new Vector2();\n    this._zoomEnd = new Vector2();\n    this._zoomDelta = new Vector2();\n\n    this.STATE = {\n      NONE: -1,\n      ROTATE: 0,\n      ZOOM: 1,\n      PAN: 2,\n      TOUCH_ROTATE: 3,\n      TOUCH_ZOOM: 4,\n      TOUCH_PAN: 5\n    };\n    this._state = this.STATE.NONE;\n\n    this.constEvents = [\n      { type: \"mousedown\", listener: this.onMouseDown.bind(this) },\n      { type: \"wheel\", listener: this.onMouseWheel.bind(this) },\n      { type: \"keydown\", listener: this.onKeyDown.bind(this), element: window },\n      { type: \"touchstart\", listener: this.onTouchStart.bind(this) },\n      { type: \"touchmove\", listener: this.onTouchMove.bind(this) },\n      { type: \"touchend\", listener: this.onTouchEnd.bind(this) },\n      { type: \"contextmenu\", listener: this.onContextMenu.bind(this) }\n    ];\n\n    this.mouseUpEvents = [\n      { type: \"mousemove\", listener: this.onMouseMove.bind(this) },\n      { type: \"mouseup\", listener: this.onMouseUp.bind(this) }\n    ];\n\n    this.constEvents.forEach((ele) => {\n      if (ele.element) {\n        ele.element.addEventListener(ele.type, ele.listener, false);\n      } else {\n        this.mainElement.addEventListener(ele.type, ele.listener, false);\n      }\n    });\n\n    this.addEventListener(\"disabled\", () => {\n      const element = this.domElement === document ? this.domElement.body : this.domElement;\n      this.mainElement.removeEventListener(this.mouseUpEvents[0].type, this.mouseUpEvents[0].listener, false);\n      element.removeEventListener(this.mouseUpEvents[1].type, this.mouseUpEvents[1].listener, false);\n    });\n  }\n\n  /**\n   * 销毁，释放事件监听\n   * @private\n   */\n  destroy() {\n    this.constEvents.forEach((ele) => {\n      if (ele.element) {\n        ele.element.removeEventListener(ele.type, ele.listener, false);\n      } else {\n        this.mainElement.removeEventListener(ele.type, ele.listener, false);\n      }\n    });\n    const element = this.domElement === document ? this.domElement.body : this.domElement;\n    this.mainElement.removeEventListener(this.mouseUpEvents[0].type, this.mouseUpEvents[0].listener, false);\n    element.removeEventListener(this.mouseUpEvents[1].type, this.mouseUpEvents[1].listener, false);\n    super.destroy();\n  }\n\n  /**\n   * 在触屏上用单指控制旋转，三指控制平移\n   */\n  setOneFingerRotate() {\n    this.touchFingers.ORBIT = 1;\n    this.touchFingers.ZOOM = 2;\n    this.touchFingers.PAN = 3;\n  }\n\n  /**\n   * 在触屏上用单指控制平移，三指控制旋转\n   */\n  setOneFingerPan() {\n    this.touchFingers.ORBIT = 3;\n    this.touchFingers.ZOOM = 2;\n    this.touchFingers.PAN = 1;\n  }\n\n  /**\n   * 每帧更新\n   * @private\n   * @param {Number} dtime 和上次绘制的事件间隔 ms\n   */\n  onUpdate(dtime) {\n    if (!this.enabled) return;\n\n    super.onUpdate(dtime);\n\n    const position: Vector3 = this.camera.position;\n    position.cloneTo(this._offset);\n    this._offset.subtract(this.target);\n    this._spherical.setFromVec3(this._offset);\n\n    if (this.autoRotate && this._state === this.STATE.NONE) {\n      this.rotateLeft(this.getAutoRotationAngle(dtime));\n    }\n\n    this._spherical.theta += this._sphericalDelta.theta;\n    this._spherical.phi += this._sphericalDelta.phi;\n\n    this._spherical.theta = Math.max(this.minAzimuthAngle, Math.min(this.maxAzimuthAngle, this._spherical.theta));\n    this._spherical.phi = Math.max(this.minPolarAngle, Math.min(this.maxPolarAngle, this._spherical.phi));\n    this._spherical.makeSafe();\n\n    if (this._scale !== 1) {\n      this._zoomFrag = this._spherical.radius * (this._scale - 1);\n    }\n\n    this._spherical.radius += this._zoomFrag;\n    this._spherical.radius = Math.max(this.minDistance, Math.min(this.maxDistance, this._spherical.radius));\n\n    this.target.add(this._panOffset);\n    this._spherical.setToVec3(this._offset);\n    this.target.cloneTo(this._position);\n    this._position.add(this._offset);\n    this.camera.position = this._position;\n    this.camera.transform.lookAt(this.target, this.up);\n\n    if (this.enableDamping === true) {\n      this._sphericalDump.theta *= 1 - this.dampingFactor;\n      this._sphericalDump.phi *= 1 - this.dampingFactor;\n      this._zoomFrag *= 1 - this.zoomFactor;\n\n      if (this._isMouseUp) {\n        this._sphericalDelta.theta = this._sphericalDump.theta;\n        this._sphericalDelta.phi = this._sphericalDump.phi;\n      } else {\n        this._sphericalDelta.set(0, 0, 0);\n      }\n    } else {\n      this._sphericalDelta.set(0, 0, 0);\n      this._zoomFrag = 0;\n    }\n\n    this._scale = 1;\n    this._panOffset.setValue(0, 0, 0);\n  }\n\n  /**\n   * 获取自动旋转的弧度\n   * @private\n   */\n  getAutoRotationAngle(dtime) {\n    return ((2 * Math.PI) / this.autoRotateSpeed / 1000) * dtime;\n  }\n\n  /**\n   * 获取缩放值\n   * @private\n   */\n  getZoomScale() {\n    return Math.pow(0.95, this.zoomSpeed);\n  }\n\n  /**\n   * 向左旋转一定弧度\n   * @property {Number} radian 旋转的弧度值\n   */\n  rotateLeft(radian) {\n    this._sphericalDelta.theta -= radian;\n    if (this.enableDamping) {\n      this._sphericalDump.theta = -radian;\n    }\n  }\n\n  /**\n   * 向上旋转一定弧度\n   * @property {Number} radian 旋转的弧度值\n   */\n  rotateUp(radian) {\n    this._sphericalDelta.phi -= radian;\n    if (this.enableDamping) {\n      this._sphericalDump.phi = -radian;\n    }\n  }\n\n  /**\n   * 向左平移\n   * @private\n   */\n  panLeft(distance: number, worldMatrix: Matrix) {\n    const e = worldMatrix.elements;\n    this._vPan.setValue(e[0], e[1], e[2]);\n    this._vPan.scale(distance);\n    this._panOffset.add(this._vPan);\n  }\n\n  /**\n   * 向右平移\n   * @private\n   */\n  panUp(distance: number, worldMatrix: Matrix) {\n    const e = worldMatrix.elements;\n    this._vPan.setValue(e[4], e[5], e[6]);\n    this._vPan.scale(distance);\n    this._panOffset.add(this._vPan);\n  }\n\n  /**\n   * 平移\n   * @property {Number} deltaX x方向的平移量，屏幕距离\n   * @property {Number} deltaY y方向的平移量，屏幕距离\n   */\n  pan(deltaX, deltaY) {\n    const element = this.domElement === document ? this.domElement.body : (this.domElement as HTMLElement);\n\n    // perspective only\n    const position: Vector3 = this.camera.position;\n    position.cloneTo(this._vPan);\n    this._vPan.subtract(this.target);\n    let targetDistance = this._vPan.length();\n\n    targetDistance *= (this.fov / 2) * (Math.PI / 180);\n\n    this.panLeft(-2 * deltaX * (targetDistance / element.clientHeight), this.camera.transform.worldMatrix);\n    this.panUp(2 * deltaY * (targetDistance / element.clientHeight), this.camera.transform.worldMatrix);\n  }\n\n  /**\n   * 放大\n   * @private\n   */\n  zoomIn(zoomScale) {\n    // perspective only\n    this._scale *= zoomScale;\n  }\n\n  /**\n   * 缩小\n   * @private\n   */\n  zoomOut(zoomScale) {\n    // perspective only\n    this._scale /= zoomScale;\n  }\n\n  /**\n   * 鼠标点击时旋转参数更新\n   * @private\n   */\n  handleMouseDownRotate(event) {\n    this._rotateStart.setValue(event.clientX, event.clientY);\n  }\n\n  /**\n   * 鼠标点击时缩放参数更新\n   * @private\n   */\n  handleMouseDownZoom(event) {\n    this._zoomStart.setValue(event.clientX, event.clientY);\n  }\n\n  /**\n   * 鼠标点击时平移参数更新\n   * @private\n   */\n  handleMouseDownPan(event) {\n    this._panStart.setValue(event.clientX, event.clientY);\n  }\n\n  /**\n   * 鼠标移动时旋转参数更新\n   * @private\n   */\n  handleMouseMoveRotate(event) {\n    this._rotateEnd.setValue(event.clientX, event.clientY);\n    Vector2.subtract(this._rotateEnd, this._rotateStart, this._rotateDelta);\n\n    const element = this.domElement === document ? document.body : (this.domElement as HTMLElement);\n\n    this.rotateLeft(2 * Math.PI * (this._rotateDelta.x / element.clientWidth) * this.rotateSpeed);\n    this.rotateUp(2 * Math.PI * (this._rotateDelta.y / element.clientHeight) * this.rotateSpeed);\n\n    this._rotateEnd.cloneTo(this._rotateStart);\n  }\n\n  /**\n   * 鼠标移动时缩放参数更新\n   * @private\n   */\n  handleMouseMoveZoom(event) {\n    this._zoomEnd.setValue(event.clientX, event.clientY);\n    Vector2.subtract(this._zoomEnd, this._zoomStart, this._zoomDelta);\n\n    if (this._zoomDelta.y > 0) {\n      this.zoomOut(this.getZoomScale());\n    } else if (this._zoomDelta.y < 0) {\n      this.zoomIn(this.getZoomScale());\n    }\n\n    this._zoomEnd.cloneTo(this._zoomStart);\n  }\n\n  /**\n   * 鼠标移动时平移参数更新\n   * @private\n   */\n  handleMouseMovePan(event: MouseEvent): void {\n    this._panEnd.setValue(event.clientX, event.clientY);\n    Vector2.subtract(this._panEnd, this._panStart, this._panDelta);\n\n    this.pan(this._panDelta.x, this._panDelta.y);\n\n    this._panEnd.cloneTo(this._panStart);\n  }\n\n  /**\n   * 鼠标滚轮滚动时缩放参数更新\n   * @private\n   */\n  handleMouseWheel(event: MouseWheelEvent): void {\n    if (event.deltaY < 0) {\n      this.zoomIn(this.getZoomScale());\n    } else if (event.deltaY > 0) {\n      this.zoomOut(this.getZoomScale());\n    }\n  }\n\n  /**\n   * 键盘按下时平移参数更新\n   * @private\n   */\n  handleKeyDown(event: KeyboardEvent) {\n    switch (event.keyCode) {\n      case this.keys.UP:\n        this.pan(0, this.keyPanSpeed);\n        break;\n      case this.keys.BOTTOM:\n        this.pan(0, -this.keyPanSpeed);\n        break;\n      case this.keys.LEFT:\n        this.pan(this.keyPanSpeed, 0);\n        break;\n      case this.keys.RIGHT:\n        this.pan(-this.keyPanSpeed, 0);\n        break;\n    }\n  }\n\n  /**\n   * 触摸落下时旋转参数更新\n   * @private\n   */\n  handleTouchStartRotate(event: TouchEvent) {\n    this._rotateStart.setValue(event.touches[0].pageX, event.touches[0].pageY);\n  }\n\n  /**\n   * 触摸落下时缩放参数更新\n   * @private\n   */\n  handleTouchStartZoom(event: TouchEvent) {\n    const dx = event.touches[0].pageX - event.touches[1].pageX;\n    const dy = event.touches[0].pageY - event.touches[1].pageY;\n\n    const distance = Math.sqrt(dx * dx + dy * dy);\n\n    this._zoomStart.setValue(0, distance);\n  }\n\n  /**\n   * 触摸落下时平移参数更新\n   * @private\n   */\n  handleTouchStartPan(event: TouchEvent) {\n    this._panStart.setValue(event.touches[0].pageX, event.touches[0].pageY);\n  }\n\n  /**\n   * 触摸移动时旋转参数更新\n   * @private\n   */\n  handleTouchMoveRotate(event: TouchEvent) {\n    this._rotateEnd.setValue(event.touches[0].pageX, event.touches[0].pageY);\n    Vector2.subtract(this._rotateEnd, this._rotateStart, this._rotateDelta);\n\n    const element = this.domElement === document ? this.domElement.body : (this.domElement as HTMLElement);\n\n    this.rotateLeft(((2 * Math.PI * this._rotateDelta.x) / element.clientWidth) * this.rotateSpeed);\n    this.rotateUp(((2 * Math.PI * this._rotateDelta.y) / element.clientHeight) * this.rotateSpeed);\n\n    this._rotateEnd.cloneTo(this._rotateStart);\n  }\n\n  /**\n   * 触摸移动时缩放参数更新\n   * @private\n   */\n  handleTouchMoveZoom(event) {\n    const dx = event.touches[0].pageX - event.touches[1].pageX;\n    const dy = event.touches[0].pageY - event.touches[1].pageY;\n\n    const distance = Math.sqrt(dx * dx + dy * dy);\n\n    this._zoomEnd.setValue(0, distance);\n\n    Vector2.subtract(this._zoomEnd, this._zoomStart, this._zoomDelta);\n\n    if (this._zoomDelta.y > 0) {\n      this.zoomIn(this.getZoomScale());\n    } else if (this._zoomDelta.y < 0) {\n      this.zoomOut(this.getZoomScale());\n    }\n\n    this._zoomEnd.cloneTo(this._zoomStart);\n  }\n\n  /**\n   * 触摸移动时平移参数更新\n   * @private\n   */\n  handleTouchMovePan(event: TouchEvent) {\n    this._panEnd.setValue(event.touches[0].pageX, event.touches[0].pageY);\n\n    Vector2.subtract(this._panEnd, this._panStart, this._panDelta);\n\n    this.pan(this._panDelta.x, this._panDelta.y);\n\n    this._panEnd.cloneTo(this._panStart);\n  }\n\n  /**\n   * 鼠标按下事件总处理\n   * @private\n   */\n  onMouseDown(event: MouseEvent) {\n    if (this.enabled === false) return;\n\n    event.preventDefault();\n\n    this._isMouseUp = false;\n\n    switch (event.button) {\n      case this.mouseButtons.ORBIT:\n        if (this.enableRotate === false) return;\n\n        this.handleMouseDownRotate(event);\n        this._state = this.STATE.ROTATE;\n        break;\n\n      case this.mouseButtons.ZOOM:\n        if (this.enableZoom === false) return;\n\n        this.handleMouseDownZoom(event);\n        this._state = this.STATE.ZOOM;\n        break;\n\n      case this.mouseButtons.PAN:\n        if (this.enablePan === false) return;\n\n        this.handleMouseDownPan(event);\n        this._state = this.STATE.PAN;\n        break;\n    }\n\n    if (this._state !== this.STATE.NONE) {\n      const element = this.domElement === document ? this.domElement.body : this.domElement;\n      this.mainElement.addEventListener(this.mouseUpEvents[0].type, this.mouseUpEvents[0].listener, false);\n      element.addEventListener(this.mouseUpEvents[1].type, this.mouseUpEvents[1].listener, false);\n    }\n  }\n\n  /**\n   * 鼠标移动事件总处理\n   * @private\n   */\n  onMouseMove(event: MouseEvent) {\n    if (this.enabled === false) return;\n\n    event.preventDefault();\n\n    switch (this._state) {\n      case this.STATE.ROTATE:\n        if (this.enableRotate === false) return;\n\n        this.handleMouseMoveRotate(event);\n        break;\n\n      case this.STATE.ZOOM:\n        if (this.enableZoom === false) return;\n\n        this.handleMouseMoveZoom(event);\n        break;\n\n      case this.STATE.PAN:\n        if (this.enablePan === false) return;\n\n        this.handleMouseMovePan(event);\n        break;\n    }\n  }\n\n  /**\n   * 鼠标抬起事件总处理\n   * @private\n   */\n  onMouseUp() {\n    if (this.enabled === false) return;\n\n    this._isMouseUp = true;\n\n    this.mouseUpEvents.forEach((ele) => {\n      const element = this.domElement === document ? this.domElement.body : this.domElement;\n      element.removeEventListener(ele.type, ele.listener, false);\n      this.mainElement.removeEventListener(ele.type, ele.listener, false);\n    });\n\n    this._state = this.STATE.NONE;\n  }\n\n  /**\n   * 鼠标滚轮滚动事件处理\n   * @private\n   */\n  onMouseWheel(event: MouseWheelEvent) {\n    if (\n      this.enabled === false ||\n      this.enableZoom === false ||\n      (this._state !== this.STATE.NONE && this._state !== this.STATE.ROTATE)\n    )\n      return;\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    this.handleMouseWheel(event);\n  }\n\n  /**\n   * 键盘按下事件总处理\n   * @private\n   */\n  onKeyDown(event: KeyboardEvent) {\n    if (this.enabled === false || this.enableKeys === false || this.enablePan === false) return;\n\n    this.handleKeyDown(event);\n  }\n\n  /**\n   * 触摸按下事件总处理\n   * @private\n   */\n  onTouchStart(event: TouchEvent) {\n    if (this.enabled === false) return;\n\n    this._isMouseUp = false;\n\n    switch (event.touches.length) {\n      case this.touchFingers.ORBIT:\n        if (this.enableRotate === false) return;\n\n        this.handleTouchStartRotate(event);\n        this._state = this.STATE.TOUCH_ROTATE;\n\n        break;\n\n      case this.touchFingers.ZOOM:\n        if (this.enableZoom === false) return;\n\n        this.handleTouchStartZoom(event);\n        this._state = this.STATE.TOUCH_ZOOM;\n\n        break;\n\n      case this.touchFingers.PAN:\n        if (this.enablePan === false) return;\n\n        this.handleTouchStartPan(event);\n        this._state = this.STATE.TOUCH_PAN;\n\n        break;\n\n      default:\n        this._state = this.STATE.NONE;\n    }\n  }\n\n  /**\n   * 触摸移动事件总处理\n   * @private\n   */\n  onTouchMove(event: TouchEvent) {\n    if (this.enabled === false) return;\n\n    event.preventDefault();\n    event.stopPropagation();\n\n    switch (event.touches.length) {\n      case this.touchFingers.ORBIT:\n        if (this.enableRotate === false) return;\n        if (this._state !== this.STATE.TOUCH_ROTATE) return;\n        this.handleTouchMoveRotate(event);\n\n        break;\n\n      case this.touchFingers.ZOOM:\n        if (this.enableZoom === false) return;\n        if (this._state !== this.STATE.TOUCH_ZOOM) return;\n        this.handleTouchMoveZoom(event);\n\n        break;\n\n      case this.touchFingers.PAN:\n        if (this.enablePan === false) return;\n        if (this._state !== this.STATE.TOUCH_PAN) return;\n        this.handleTouchMovePan(event);\n\n        break;\n\n      default:\n        this._state = this.STATE.NONE;\n    }\n  }\n\n  /**\n   * 触摸抬起事件总处理\n   * @private\n   */\n  onTouchEnd() {\n    if (this.enabled === false) return;\n\n    this._isMouseUp = true;\n    this._state = this.STATE.NONE;\n  }\n\n  /**\n   * 上下文事件隐藏\n   * @private\n   */\n  onContextMenu(event) {\n    if (this.enabled === false) return;\n    event.preventDefault();\n  }\n}\n"],"names":["ESP","MathUtil","zeroTolerance","includes","array","filterArray","some","e","indexOf","tween","Tween","FreeControl","entity","_forward","Vector3","_right","camera","mainElement","domElement","movementSpeed","rotateSpeed","floorMock","floorY","jumpY","jumpDuration","press","keysForward","keysBackward","keysLeft","keysRight","keysJump","_theta","_phi","_moveForward","_moveBackward","_moveLeft","_moveRight","_moveJump","_v3Cache","_spherical","_rotateOri","_events","tempVec3","_this","scene","engine","canvas","_webCanvas","document","Spherical","type","listener","onMouseMove","bind","onMouseDown","onMouseUp","onKeyDown","element","window","onKeyUp","onContextMenu","initEvents","updateSpherical","event","preventDefault","code","key","keyCode","this","jump","stopPropagation","changedTouches","focus","clientX","clientY","enabled","movementX","movementY","actualX","width","actualY","height","rotate","alpha","beta","degreeToRadian","clamp","Math","PI","theta","phi","setToVec3","add","position","transform","lookAt","p","doTransform","Translate","x","z","easing","Easing","easeOutSine","onComplete","_this2","easeInSine","start","axis","distance","v3","diff","normalize","scale","delta","actualMoveSpeed","getWorldForward","getWorldRight","translateOnAxis","update","setValue","forEach","ele","addEventListener","_this3","removeEventListener","_this4","transformByQuat","rotation","setFromVec3","Script","OrbitControl","fov","target","up","minDistance","maxDistance","minZoom","maxZoom","enableDamping","zoomFactor","enableRotate","keyPanSpeed","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableZoom","dampingFactor","zoomSpeed","enablePan","autoRotate","autoRotateSpeed","enableKeys","keys","mouseButtons","touchFingers","_position","_offset","_sphericalDelta","_sphericalDump","_zoomFrag","_scale","_panOffset","_isMouseUp","_vPan","constEvents","_state","_rotateStart","_rotateEnd","_rotateDelta","_panStart","_panEnd","_panDelta","_zoomStart","_zoomEnd","_zoomDelta","STATE","mouseUpEvents","Infinity","LEFT","UP","RIGHT","BOTTOM","ORBIT","ZOOM","PAN","Vector2","NONE","ROTATE","TOUCH_ROTATE","TOUCH_ZOOM","TOUCH_PAN","onMouseWheel","onTouchStart","onTouchMove","onTouchEnd","body","dtime","cloneTo","subtract","rotateLeft","getAutoRotationAngle","max","min","makeSafe","radius","set","pow","radian","worldMatrix","elements","deltaX","deltaY","targetDistance","length","panLeft","clientHeight","panUp","zoomScale","clientWidth","rotateUp","y","zoomOut","getZoomScale","zoomIn","pan","touches","pageX","pageY","dx","dy","sqrt","button","handleMouseDownRotate","handleMouseDownZoom","handleMouseDownPan","handleMouseMoveRotate","handleMouseMoveZoom","handleMouseMovePan","handleMouseWheel","handleKeyDown","handleTouchStartRotate","handleTouchStartZoom","handleTouchStartPan","handleTouchMoveRotate","handleTouchMoveZoom","handleTouchMovePan"],"mappings":"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"}