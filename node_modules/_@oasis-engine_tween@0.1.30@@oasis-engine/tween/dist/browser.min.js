!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("oasis-engine")):"function"==typeof define&&define.amd?define(["exports","oasis-engine"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["@oasisEngine/tween"]={},t.oasisEngine)}(this,(function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=s(t);if(e){var r=s(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return l(this,n)}}var p=function(){function t(){n(this,t),this._nextId=void 0,this.tweeners=void 0,this._nextId=0,this.tweeners={}}return r(t,[{key:"getId",value:function(){return this._nextId++}},{key:"add",value:function(t){t.id||(t.id=this.getId()),this.tweeners[t.id]=t}},{key:"update",value:function(t){for(var e in this.tweeners){var n=this.tweeners[e];n.update(t),n._played&&n._paused&&!n.preserved&&delete this.tweeners[e]}}}]),t}(),h={Restart:0,Yoyo:1},d=.1,v="function"==typeof Float32Array;function y(t,e){return 1-3*e+3*t}function g(t,e){return 3*e-6*t}function w(t){return 3*t}function O(t,e,n){return((y(e,n)*t+g(e,n))*t+w(e))*t}function b(t,e,n){return 3*y(e,n)*t*t+2*g(e,n)*t+w(e)}function _(t){return t}function m(t,e,n,i){if(!(0<=t&&t<=1&&0<=n&&n<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&n===i)return _;for(var r=v?new Float32Array(11):new Array(11),o=0;o<11;++o)r[o]=O(o*d,t,n);function u(e){for(var i=0,o=1;10!==o&&r[o]<=e;++o)i+=d;--o;var u=i+(e-r[o])/(r[o+1]-r[o])*d,a=b(u,t,n);return a>=.001?function(t,e,n,i){for(var r=0;r<4;++r){var o=b(e,n,i);if(0===o)return e;e-=(O(e,n,i)-t)/o}return e}(e,u,t,n):0===a?u:function(t,e,n,i,r){var o,u,a=0;do{(o=O(u=e+(n-e)/2,i,r)-t)>0?n=u:e=u}while(Math.abs(o)>1e-7&&++a<10);return u}(e,i,i+d,t,n)}return function(t){return 0===t||1===t?t:O(u(t),e,i)}}function M(t,e,n,i){return n*t/i+e}function I(t,e,n,i){return n-T(i-t,0,n,i)+e}function T(t,e,n,i){return(t/=i)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e}var P=Object.freeze({__proto__:null,linear:M,easeInQuad:function(t,e,n,i){return n*(t/=i)*t+e},easeOutQuad:function(t,e,n,i){return-n*(t/=i)*(t-2)+e},easeInOutQuad:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},easeInCubic:function(t,e,n,i){return n*(t/=i)*t*t+e},easeOutCubic:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},easeInOutCubic:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},easeInQuart:function(t,e,n,i){return n*(t/=i)*t*t*t+e},easeOutQuart:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},easeInOutQuart:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},easeInQuint:function(t,e,n,i){return n*(t/=i)*t*t*t*t+e},easeOutQuint:function(t,e,n,i){return n*((t=t/i-1)*t*t*t*t+1)+e},easeInOutQuint:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},easeInSine:function(t,e,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+e},easeOutSine:function(t,e,n,i){return n*Math.sin(t/i*(Math.PI/2))+e},easeInOutSine:function(t,e,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+e},easeInExpo:function(t,e,n,i){var r;return null!==(r=0===t)?r:{b:n*Math.pow(2,10*(t/i-1))+e}},easeOutExpo:function(t,e,n,i){var r;return null!==(r=t===i)?r:e+{c:n*(1-Math.pow(2,-10*t/i))+e}},easeInOutExpo:function(t,e,n,i){return(t/=i/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(2-Math.pow(2,-10*--t))+e},easeInCirc:function(t,e,n,i){return-n*(Math.sqrt(1-(t/=i)*t)-1)+e},easeOutCirc:function(t,e,n,i){return n*Math.sqrt(1-(t=t/i-1)*t)+e},easeInOutCirc:function(t,e,n,i){return(t/=i/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e},easeInElastic:function(t,e,n,i){var r,o,u;return u=1.70158,0===t||(t/=i),(o=0)||(o=.3*i),(r=n)<Math.abs(n)?(r=n,u=o/4):u=o/(2*Math.PI)*Math.asin(n/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*i-u)*(2*Math.PI)/o)+e},easeOutElastic:function(t,e,n,i){var r,o,u;return u=1.70158,0===t||(t/=i),(o=0)||(o=.3*i),(r=n)<Math.abs(n)?(r=n,u=o/4):u=o/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*t)*Math.sin((t*i-u)*(2*Math.PI)/o)+n+e},easeInOutElastic:function(t,e,n,i){var r,o,u;return u=1.70158,0===t||(t/=i/2),(o=0)||(o=i*(.3*1.5)),(r=n)<Math.abs(n)?(r=n,u=o/4):u=o/(2*Math.PI)*Math.asin(n/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*i-u)*(2*Math.PI)/o)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-u)*(2*Math.PI)/o)*.5+n+e},easeInBack:function(t,e,n,i,r){return void 0===r&&(r=1.70158),n*(t/=i)*t*((r+1)*t-r)+e},easeOutBack:function(t,e,n,i,r){return void 0===r&&(r=1.70158),n*((t=t/i-1)*t*((r+1)*t+r)+1)+e},easeInOutBack:function(t,e,n,i,r){return void 0===r&&(r=1.70158),(t/=i/2)<1?n/2*(t*t*((1+(r*=1.525))*t-r))+e:n/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},easeInBounce:I,easeOutBounce:T,easeInOutBounce:function(t,e,n,i){return t<i/2?.5*I(2*t,0,n,i)+e:.5*T(2*t-i,0,n,i)+.5*n+e},bezierEasing:function(t,e,n,i){var r=m(t,e,n,i);return function(t,e,n,i){return n*r(t/i)+e}}}),V=function(){},j=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(i,t);var e=f(i);function i(t,r,o,u){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return n(this,i),e.call(this,t,r,o,u,a,s)}return r(i,[{key:"duration",value:function(){var t=0;return t=-1===this.options.loops.count?-1:this.options.delay+this.options.loops.count*this.interval,t}},{key:"update",value:function(t){if(this._time+=t,!this._paused){if(this.options.delay>this._time)return!0;if(this.elapsedTime+=t,this.elapsedTime=this.elapsedTime>this.interval?this.interval:this.elapsedTime,this.options.plugin(this),this.options.onTick(this),this.elapsedTime===this.interval)if(this._remainLoops>0||this._remainLoops<=-1)switch(this.options.loops.type){case h.Yoyo:this.rewind=!this.rewind,this.elapsedTime=0,this.rewind||this._remainLoops--;break;case h.Restart:this.elapsedTime=0,this._remainLoops--}else this.stop();return!0}}}]),i}(function(){function t(e,i,r,o){var u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};n(this,t),this._time=void 0,this._paused=void 0,this._remainLoops=void 0,this._played=void 0,this.options=void 0,this.elapsedTime=void 0,this.interval=void 0,this.rewind=void 0,this.preserved=void 0,this.startValue=void 0,this.endValue=void 0,this.getter=void 0,this.setter=void 0,this.options=a({id:"",loops:{count:0,type:h.Yoyo},easing:M,delay:0,plugin:V,pluginOptions:{},onComplete:V,onTick:V},u),this._time=0,this._remainLoops=this.options.loops.count||0,this._paused=!0,this._played=!1,this.rewind=!1,this.preserved=!1,this.elapsedTime=0,this.startValue=e(),this.endValue=r,this.getter=e,this.setter=i,this.interval=o}return r(t,[{key:"duration",value:function(){}},{key:"update",value:function(t){}},{key:"setLoops",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.Yoyo;return this.options.loops={count:t,type:e},this._remainLoops=t,this}},{key:"set",value:function(t,e){return this.options=a(a({},this.options),o({},t,e)),this}},{key:"stop",value:function(){return this.options.onComplete(this),this._paused=!0,this}},{key:"pause",value:function(){return!this._paused&&(this._paused=!0,this)}},{key:"start",value:function(t){return t&&t.add(this),!!this._paused&&(this.elapsedTime=0,this._paused=!1,this._played=!0,this)}}]),t}()),k=function(t){var n=t.options.easing,i=new e.Quaternion,r=n(t.elapsedTime,0,1,t.interval);e.Quaternion.slerp(t.startValue,t.endValue,r,i),t.setter(i)},E=function(t){var e=(0,t.options.easing)(t.elapsedTime,t.startValue,t.endValue-t.startValue,t.interval);t.setter(e)},x=function(t,e,n){var i=t.options.easing,r=t.startValue[e],o=t.endValue[e]-t.startValue[e];t.rewind&&(r=t.endValue[e],o=t.startValue[e]-t.endValue[e]),n[e]=i(t.elapsedTime,r,o,t.interval)},C=function(t){return function(n){var i;switch(t){case 2:i=new e.Vector2,x(n,"x",i),x(n,"y",i);break;case 3:i=new e.Vector3,x(n,"x",i),x(n,"y",i),x(n,"z",i);break;default:i=new e.Vector4,x(n,"x",i),x(n,"y",i),x(n,"z",i),x(n,"w",i)}n.setter(i)}},L=C(2),Q=C(3),D=C(4),R=Object.freeze({__proto__:null,QuaternionPlugin:k,FloatPlugin:E,Vector2Plugin:L,Vector3Plugin:Q,Vector4Plugin:D}),S={Rotate:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return i.plugin=i.plugin||k,new j((function(){return t.rotation.clone()}),(function(e){return t.rotation=e}),e,n,i,t)},Translate:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return i.plugin=i.plugin||Q,new j((function(){return t.position.clone()}),(function(e){return t.position=e}),e,n,i,t)},Scale:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return i.plugin=i.plugin||Q,new j((function(){return t.scale.clone()}),(function(e){return t.scale=e}),e,n,i,t)},DataType:function(t,n,i,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return o.dataType===e.DataType.FLOAT_VEC2?(o.plugin=o.plugin||L,new j((function(){return t.clone()}),n,i,r,o)):o.dataType===e.DataType.FLOAT_VEC3||o.dataType===e.DataType.FLOAT_VEC4?(o.plugin=o.plugin||Q,new j((function(){return t.clone()}),n,i,r,o)):(o.plugin=o.plugin||E,new j((function(){return t}),n,i,r,o))}},F={Float:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return r.plugin=r.plugin||E,new j((function(){return t.getValue(n)}),(function(e){return t.setValue(n,e)}),e,i,r,t)},Color:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return r.plugin=r.plugin||Q,new j((function(){return t.getValue(n)}),(function(e){t.setValue(n,[e[0]/255,e[1]/255,e[2]/255])}),e,i,r,t)}};t.Easing=P,t.LOOP_TYPE=h,t.Tween=p,t.TweenPlugins=R,t.Tweener=j,t.doMaterial=F,t.doTransform=S,Object.defineProperty(t,"__esModule",{value:!0})}));
